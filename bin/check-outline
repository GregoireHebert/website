#!/usr/bin/env node

const {docPagesDirectory, versions} = require('../constants');
const {readdirSync, readFileSync, statSync} = require('fs');
const {join} = require('path');
const jsYaml = require('js-yaml');

const loadedOutline = jsYaml.safeLoad(readFileSync(`${__dirname}/../config/outline.yaml`, 'utf8'));

versions.map(version => {
    const dir = `${docPagesDirectory}${version}`;
    const directories = (() => readdirSync(dir).filter(
            folder => statSync(join(dir, folder)).isDirectory() && '.' !== folder[0])
    )();

    const outlineDirectories = Object
        .keys(loadedOutline.chapters)
        .map(key => loadedOutline.chapters[key].path);

    const oddDirectories = {
        missingDirectories: directories.filter(folder => !outlineDirectories.includes(folder)),
        extraDirectories: outlineDirectories.filter(folder => !directories.includes(folder)),
    };

    if (oddDirectories.missingDirectories.length > 0) {
        console.warn('\x1b[31m', `The following "path" entries are missing in "outline.yaml", please add them with the relevants "title" and "items" keys: ${oddDirectories.missingDirectories.join(', ')}`, '\x1b[37m');
    }
});
